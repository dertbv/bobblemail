#!/bin/bash

# ATLAS Enhanced Orchestration with Todo Tracking
# Usage: ./atlas-orchestrate-todo "task description"

echo "🏛️  ATLAS Enhanced Orchestration + Todo Tracking"
echo "════════════════════════════════════════════════"
echo ""

if [ -z "$1" ]; then
    echo "Usage: ./atlas-orchestrate-todo \"Complex task description\""
    echo ""
    echo "Examples:"
    echo "  ./atlas-orchestrate-todo \"Implement OAuth authentication system\""
    echo "  ./atlas-orchestrate-todo \"Debug performance issues in email processing\""
    echo "  ./atlas-orchestrate-todo \"Refactor database schema for scalability\""
    exit 1
fi

TASK_DESCRIPTION="$1"
TIMESTAMP=$(date +"%Y_%m_%d_%H%M")

echo "📋 Task: $TASK_DESCRIPTION"
echo "⏰ Started: $(date)"
echo "✅ Todo tracking enabled"
echo ""

# Update FRESH_COMPACT_MEMORY with current task
echo "## ATLAS Enhanced Orchestration Session - $TIMESTAMP" >> FRESH_COMPACT_MEMORY.md
echo "" >> FRESH_COMPACT_MEMORY.md
echo "**Task**: $TASK_DESCRIPTION" >> FRESH_COMPACT_MEMORY.md
echo "**Started**: $(date)" >> FRESH_COMPACT_MEMORY.md
echo "**Mode**: Enhanced Orchestration with Todo Tracking" >> FRESH_COMPACT_MEMORY.md
echo "" >> FRESH_COMPACT_MEMORY.md

# Create working log entry
CURRENT_DATE=$(date +"%Y_%m_%d")
CURRENT_MONTH_DIR="WORKING_LOG/$(date +"%Y/%m-%b")"
WORKING_LOG_FILE="$CURRENT_MONTH_DIR/wl_$CURRENT_DATE.md"

# Ensure directory exists
mkdir -p "$CURRENT_MONTH_DIR"

# Add entry to working log
echo "" >> "$WORKING_LOG_FILE"
echo "## ENHANCED ORCHESTRATION + TODOS - $TIMESTAMP" >> "$WORKING_LOG_FILE"
echo "" >> "$WORKING_LOG_FILE"
echo "**Task**: $TASK_DESCRIPTION" >> "$WORKING_LOG_FILE"
echo "**Mode**: Enhanced Orchestration with Todo Tracking" >> "$WORKING_LOG_FILE"
echo "**Status**: Planning Phase" >> "$WORKING_LOG_FILE"
echo "" >> "$WORKING_LOG_FILE"

# Create the todo file
TODO_FILE="atlas_todos_$TIMESTAMP.md"

cat > "$TODO_FILE" << EOF
# ATLAS Enhanced Orchestration Todos
**Task**: $TASK_DESCRIPTION  
**Created**: $(date)  

## Phase 1: ATLAS Strategic Planning
- [ ] **Experience-based analysis**: Apply FAANG + startup experience to understand scope
- [ ] **Professional task decomposition**: Break into logical subtasks
- [ ] **Quality standards setting**: Apply DEVELOPMENT_BELIEFS.md principles

## Phase 2: ATLAS Systematic Execution  
- [ ] **Context loading**: Review relevant MEMORY/ and WORKING_LOG/ sections
- [ ] **Subtask implementation**: Work through each identified subtask systematically
- [ ] **Progress documentation**: Update FRESH_COMPACT_MEMORY.md with progress
- [ ] **Inter-subtask coordination**: Maintain context between related work pieces

## Phase 3: ATLAS Quality Orchestration
- [ ] **Professional quality evaluation**: Apply accumulated standards to assess work quality
- [ ] **Code review preparation**: Stage work and request Boss review with context
- [ ] **Iteration if needed**: Refine work if quality doesn't meet standards

## Phase 4: ATLAS Learning Integration  
- [ ] **Pattern extraction**: Identify new techniques for future similar work
- [ ] **Memory system updates**: Update relevant MEMORY/ files with insights
- [ ] **Working log documentation**: Document high-entropy information and discoveries
- [ ] **Professional growth**: Reflect on how experience applied to this challenge

---

## Custom Subtasks
*Add your specific subtasks here during Phase 1 planning:*

- [ ] 
- [ ] 
- [ ] 

## Notes & Insights
*Capture key insights, decisions, and learnings:*

EOF

# Add working log checklist too
echo "### Phase 1: ATLAS Strategic Planning" >> "$WORKING_LOG_FILE"
echo "- [ ] Experience-based analysis" >> "$WORKING_LOG_FILE"
echo "- [ ] Professional task decomposition" >> "$WORKING_LOG_FILE"
echo "- [ ] Quality standards setting" >> "$WORKING_LOG_FILE"
echo "" >> "$WORKING_LOG_FILE"
echo "### Phase 2: ATLAS Systematic Execution" >> "$WORKING_LOG_FILE"
echo "- [ ] Subtask implementation loop" >> "$WORKING_LOG_FILE"
echo "- [ ] Inter-subtask context management" >> "$WORKING_LOG_FILE"
echo "" >> "$WORKING_LOG_FILE"
echo "### Phase 3: ATLAS Quality Orchestration" >> "$WORKING_LOG_FILE"
echo "- [ ] Professional quality evaluation" >> "$WORKING_LOG_FILE"
echo "- [ ] Git integration with enhanced workflow" >> "$WORKING_LOG_FILE"
echo "" >> "$WORKING_LOG_FILE"
echo "### Phase 4: ATLAS Learning Integration" >> "$WORKING_LOG_FILE"
echo "- [ ] Knowledge extraction" >> "$WORKING_LOG_FILE"
echo "- [ ] Memory system updates" >> "$WORKING_LOG_FILE"
echo "- [ ] Professional growth integration" >> "$WORKING_LOG_FILE"
echo "" >> "$WORKING_LOG_FILE"

echo "✅ Session initialized"
echo "📝 Updated: FRESH_COMPACT_MEMORY.md"
echo "📊 Created: $WORKING_LOG_FILE"
echo "📋 Created: $TODO_FILE"
echo ""
echo "💡 Next steps:"
echo "   1. Open $TODO_FILE in Claude Code to track progress"
echo "   2. Add specific subtasks during Phase 1 planning"
echo "   3. Check off items as you complete them"
echo ""
echo "Ready for Enhanced Orchestration Protocol..."
